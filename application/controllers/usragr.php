<?phpclass usragr extends CI_Controller{    public function index()    {        $this->load->model('usragr_model');        $data['title'] = "COPY REQUEST/USE AGREEMENT FORM";        $date = date_default_timezone_set('US/Eastern');        $this->load->view('initiateUseAgreement', $data);    }    public function useagreement()    {        $data['title'] = "COPY REQUEST/USE AGREEMENT FORM";        $date = date_default_timezone_set('US/Eastern');        $this->load->model('usragr_model');        $userId = $this->input->get('userId');        $result = $this->usragr_model->getresearcher($userId);        $researcher = array();        $info = json_decode(json_encode($result), true);        foreach($info as $row){            $request = array();            if(sizeof($researcher)==0) {                array_push($researcher, $row['userName'], $row['citystate'],                    $row['address'], $row['emailId'], $row['zipCode'],                    $row['comments'], $row['date'], $row['phoneNumber']);                    $data['researcher'] =$researcher;            }            $request[]= $row['requestId'];            $request[] = $row['collection'];            $request[] = $row['boxNumber'];            $request[] = $row['itemNumber'];            $request[] = explode(':',$row['imageResolution']);            $request[] = explode(':', $row['fileFormat']);            $request[] = explode(':',$row['audOrVidFileFormat']);            //  print_r($request);            $requests[] =$request;            $data['requests']= $requests;        }        $this->load->view('useAgreement', $data);    }    // Function for adding new researcher into the system    public function insertNewResearcher()    {        date_default_timezone_set('US/Eastern');        $date = date("m/d/Y");        $data = array(            'userName'   => $_POST['userName'],            'emailId'    => $_POST['emailId'],            'citystate'  => $_POST['citystate'],            'address'    => $_POST['address'],            'zipCode'    => $_POST['zipCode'],            'comments'   => $_POST['comments'],            'date'       => $_POST['date'],            'phoneNumber'=> $_POST['phoneNumber']        );        $this->load->model('usragr_model');        $result = $this->usragr_model->insert_researcher($data, 'researcher');        //echo $result;        if ($result > 0) {            $userId = $result; // As the result from model returns maximum value of research table            $requestCount = $_POST['requestCount'];            //check if there is any requests            if ($requestCount != 0) {                $requestList = array($_POST['requestList']);                //processiong array of requests                foreach ($requestList as $request) {                    foreach ($request as $row) {                        //data of request row                        $data = array(                            'collection'      => $row[0],                            'boxNumber'       => $row[1],                            'itemNumber'      => $row[2],                            'imageResolution' => $row[3],                            'fileFormat'      => $row[4],                            'audOrVidFileFormat' => $row[5],                            'userId'          => $userId                        );                        //insert the request                        $response = $this->usragr_model->insertUserRequest($data, 'request');                        if ($response > 0) {                        }else{                            return 0;                        }                    }}// end of processing requests            }            $this->load->library('email');            $this->email->from('dheeraj.edu@gmail.com', ' Name');            $this->email->to($_POST['emailId']);            $this->email->subject('Email Test');            $this->email->message('Testing the email class.');           // $this->email->send();            echo $result;        }    }// function to fetch the researcher with userId    public function getResearcher()    {        /*WORKING*/        $this->load->model('usragr_model');        $userId = $this->input->get('userId');        $result = $this->usragr_model->getresearcher($userId);        $researcher = array();            $info = json_decode(json_encode($result), true);           foreach($info as $row){               $request = array();               if(sizeof($researcher)==0) {                   array_push($researcher, $row['userName'], $row['citystate'],                       $row['address'], $row['emailId'], $row['zipCode'],                       $row['comments'], $row['date'], $row['phoneNumber']);                   $data['researcher'] =$researcher;               }               $request[]= $row['requestId'];               $request[] = $row['collection'];               $request[] = $row['boxNumber'];               $request[] = $row['itemNumber'];               $request[] = explode(':',$row['imageResolution']);               $request[] = explode(':', $row['fileFormat']);               $request[] = explode(':',$row['audOrVidFileFormat']);               $requests[] =$request;               $data['requests']= $requests;           }        $this->load->view('useAgreement', $data);    }    //Function to update researcher.    public function updateResearcher()    {        $userId = $this->input->get('userId');        //  $id= $this->input->post($researcherId);        date_default_timezone_set('US/Eastern');        $date = date("m/d/Y");        $this->load->model('usragr_model');        //updating researcher information        $result = $this->usragr_model->update_researcher($_POST['userName'], $_POST['citystate'], $_POST['address'], $_POST['emailId'],            $_POST['zipCode'], $_POST['comments'], $_POST['date'], $_POST['phoneNumber'],$userId);        if($result>0) {   //Deleting existing requests            $result = $this->usragr_model->deleteRequests($userId);        }        //echo $result;        if ($result > 0) { //Inserting New Requests             $data = [''];           // $userId = $result; // As the result from model returns maximum value of research table            $requestCount = $_POST['requestCount'];            //check if there is any requests            if ($requestCount != 0) {                $requestList = array($_POST['requestList']);                //processiong array of requests                foreach ($requestList as $request) {                    foreach ($request as $row) {                        //data of request row                        $data = array(                            'collection'         => $row[0],                            'boxNumber'          => $row[1],                            'itemNumber'         => $row[2],                            'imageResolution'    => $row[3],                            'fileFormat'         => $row[4],                            'audOrVidFileFormat' => $row[5],                            'userId'             => $userId                        );                        //insert the request                        $result = $this->usragr_model->insertUserRequest($data, 'request');                    }}// end of processing requests            }            if($result>0){                echo $userId;            }        }        //sending emailId        $this->load->library('email');        $this->email->from('dheeraj.karnati1@marist.edu', 'Dheeraj');        $this->email->to('dheeraj.edu@gmail.com');        //  $this->email->cc('another@another-example.com');        //$this->email->bcc('them@their-example.com');        $this->email->subject('Email Test');        $this->email->message('Testing the email class.');        //$this->email->send();    }}?>
<?phpclass usragr extends CI_Controller{    public function index()    {        $this->load->model('usragr_model');        $data['title'] = "COPY REQUEST/USE AGREEMENT FORM";        $date = date_default_timezone_set('US/Eastern');        $this->load->view('initiateUseAgreement', $data);    }    public function useagreement()    {       // $this->load->model('usragr_model');        $data['title'] = "COPY REQUEST/USE AGREEMENT FORM";        $date = date_default_timezone_set('US/Eastern');        $this->load->model('usragr_model');        $userId = $this->input->get('userId');        $result = $this->usragr_model->getresearcher($userId);        //  $rscrAndReqInfo= array();        $researcher = array();        // foreach($result as $row){        //   echo sizeof($row);        $info = json_decode(json_encode($result), true);        foreach($info as $row){            //  $data['userName'] =            $request = array();            if(sizeof($researcher)==0) {                array_push($researcher, $row['userName'], $row['citystate'],                    $row['address'], $row['emailId'], $row['zipCode'],                    $row['comments'], $row['date'], $row['phoneNumber']);                    $data['researcher'] =$researcher;            }            $request[]= $row['requestId'];            $request[] = $row['collection'];            $request[] = $row['boxNumber'];            $request[] = $row['itemNumber'];            $request[] = explode(':',$row['imageResolution']);            $request[] = explode(':', $row['fileFormat']);            $request[] = explode(':',$row['audOrVidFileFormat']);            //  print_r($request);            $requests[] =$request;            $data['requests']= $requests;        }        //print_r($data);        //  print_r(sizeof($rscrAndReqInfo));        $this->load->view('useAgreement', $data);    //    $this->load->view('useAgreement', $data);    }    /*	public function admin() {            $this -> load -> model('rsrq_model');            $this -> load -> view('admin', $data);        }*/    /**     *     */    // Function for adding new researcher into the system    public function insertNewResearcher()    {        date_default_timezone_set('US/Eastern');        $date = date("m/d/Y");        $data = array(            'userName'   => $_POST['userName'],            'emailId'    => $_POST['emailId'],            'citystate'  => $_POST['citystate'],            'address'    => $_POST['address'],            'zipCode'    => $_POST['zipCode'],            'comments'   => $_POST['comments'],            'date'       => $_POST['date'],            'phoneNumber'=> $_POST['phoneNumber']        );        $this->load->model('usragr_model');        $result = $this->usragr_model->insert_researcher($data, 'researcher');        //echo $result;        if ($result > 0) {            $userId = $result; // As the result from model returns maximum value of research table            $requestCount = $_POST['requestCount'];            //check if there is any requests            if ($requestCount != 0) {                $requestList = array($_POST['requestList']);                //processiong array of requests                foreach ($requestList as $request) {                    foreach ($request as $row) {                        //data of request row                        $data = array(                            'collection'      => $row[0],                            'boxNumber'       => $row[1],                            'itemNumber'      => $row[2],                            'imageResolution' => $row[3],                            'fileFormat'      => $row[4],                            'audOrVidFileFormat' => $row[5],                            'userId'          => $userId                        );                        //insert the request                        $response = $this->usragr_model->insertUserRequest($data, 'request');                        if ($response > 0) {                        }else{                            return 0;                        }                    }}// end of processing requests            }            $this->load->library('email');            $this->email->from('dheeraj.edu@gmail.com', ' Name');            $this->email->to($_POST['emailId']);            //  $this->email->cc('another@another-example.com');            //$this->email->bcc('them@their-example.com');            $this->email->subject('Email Test');            $this->email->message('Testing the email class.');           // $this->email->send();            echo $result;            //echo $this->email->print_debugger();            /*$headers = 'From:dheeraj.edu@gmail.com'."\r\n".'X-Mailer:PHP/'.phpversion();            $to = $_POST['emailId'];            echo $_POST['emailId'];            $subject='USE AGREEMENT';            $message="library.marist.edu/useagreement/c=usragr&m=getResearcher&id=".$userId;            if(mail($to,$subject,$message,$headers)){                echo "message sent successfully for userId =".$userId;            }*/        }    }// function to fetch the researcher with userId    public function getResearcher()    {        /*WORKING*/        $this->load->model('usragr_model');        $userId = $this->input->get('userId');        $result = $this->usragr_model->getresearcher($userId);      //  $rscrAndReqInfo= array();        $researcher = array();       // foreach($result as $row){        //   echo sizeof($row);            $info = json_decode(json_encode($result), true);           foreach($info as $row){             //  $data['userName'] =               $request = array();               if(sizeof($researcher)==0) {                   array_push($researcher, $row['userName'], $row['citystate'],                       $row['address'], $row['emailId'], $row['zipCode'],                       $row['comments'], $row['date'], $row['phoneNumber']);                   $data['researcher'] =$researcher;               }               $request[]= $row['requestId'];               $request[] = $row['collection'];               $request[] = $row['boxNumber'];               $request[] = $row['itemNumber'];               $request[] = explode(':',$row['imageResolution']);               $request[] = explode(':', $row['fileFormat']);               $request[] = explode(':',$row['audOrVidFileFormat']);             //  print_r($request);               $requests[] =$request;               $data['requests']= $requests;           }        //print_r($data);      //  print_r(sizeof($rscrAndReqInfo));        $this->load->view('useAgreement', $data);        //  }       //  print_r($result);    }    public function updateUser(){        $this->load->model('usragr_model');    }    //Function to update researcher.    public function updateResearcher()    {        $userId = $this->input->get('userId');        //  $id= $this->input->post($researcherId);        date_default_timezone_set('US/Eastern');        $date = date("m/d/Y");        $this->load->model('usragr_model');        //updating researcher information        $result = $this->usragr_model->update_researcher($_POST['userName'], $_POST['citystate'], $_POST['address'], $_POST['emailId'],            $_POST['zipCode'], $_POST['comments'], $_POST['date'], $_POST['phoneNumber'],$userId);        if($result>0) {   //Deleting existing requests            $result = $this->usragr_model->deleteRequests($userId);        }        //echo $result;        if ($result > 0) { //Inserting New Requests             $data = [''];           // $userId = $result; // As the result from model returns maximum value of research table            $requestCount = $_POST['requestCount'];            //check if there is any requests            if ($requestCount != 0) {                $requestList = array($_POST['requestList']);                //processiong array of requests                foreach ($requestList as $request) {                    foreach ($request as $row) {                        //data of request row                        $data = array(                            'collection'         => $row[0],                            'boxNumber'          => $row[1],                            'itemNumber'         => $row[2],                            'imageResolution'    => $row[3],                            'fileFormat'         => $row[4],                            'audOrVidFileFormat' => $row[5],                            'userId'             => $userId                        );                        //insert the request                        $result = $this->usragr_model->insertUserRequest($data, 'request');                    }}// end of processing requests            }            if($result>0){                echo $userId;            }            //echo $this->email->print_debugger();          /*  $headers = 'From:dheeraj.edu@gmail.com'."\r\n".'X-Mailer:PHP/'.phpversion();            $to = $_POST['emailId'];            echo $_POST['emailId'];            $subject='USE AGREEMENT';            $message="library.marist.edu/useagreement/c=usragr&m=getResearcher&id=".$userId;            if(mail($to,$subject,$message,$headers)){                echo "message sent successfully for userId =".$userId;            }*/        }        $this->load->library('email');        $this->email->from('dheeraj.karnati1@marist.edu', 'Dheeraj');        $this->email->to('dheeraj.edu@gmail.com');        //  $this->email->cc('another@another-example.com');        //$this->email->bcc('them@their-example.com');        $this->email->subject('Email Test');        $this->email->message('Testing the email class.');        $this->email->send();        // $this->load->library('upload');/*           if($_FILES['file']['size'] > 0) { // upload is the name of the file field in the form            $aConfig['upload_path']      = '/someUploadDir/';            $aConfig['allowed_types']    = 'doc|docx|pdf|jpg|png';            $aConfig['max_size']     = '3000';            $aConfig['max_width']        = '1280';            $aConfig['max_height']       = '1024';            $this->upload->initialize($aConfig);            if($this->upload->do_upload('file'))            {                $ret = $this->upload->data();            } else {            }            $pathToUploadedFile = $ret['full_path'];*/// }        //$path = set_realpath('http://www.gettyimages.ca/gi-resources/images/Homepage/Category-Creative/UK/');      //  $this->email->attach( $_POST['uploadedFile']);       // $this->email->attach('UK_Creative_462809583.jpg');        //  $this->load->view('useAgreement', $data);      //  $this->email->send();        /*$data = array(            'requestName'=> $_POST['requestName'],            'requestDescription' => $_POST['requestDescription'],            'boxNumber' => $_POST['boxNumber'],            'itemNumber'=> $_POST['itemNumber'],            'fileType'=> $_POST['fileType']            /*'imageResolution'=> $_POST['imageResolution'],            'fileFormat'=> $_POST['fileFormat'],            'audOrVidFileFormat' => $_POST['audOrVidFileFormat'],            'userId' => $userId */        //);        //$imageResolution = '1220*800';        //$fileFormat = 'text';        //$audOrVidFileFormat = 'mp4';        //for($i=0;$i<= sizeof($data);$i++){            //inserting use agreement information            /*NOT WORKING:Error in PDO: Problem with Query*/          //  $result = $this -> usragr_model -> insertUseAgreementInformation($_POST['requestName'],$_POST['requestDescription'],$_POST['boxNumber'],$_POST['itemNumber'],            //    $_POST['fileType'],$imageResolution,$fileFormat,$audOrVidFileFormat,$userId);        //}        //echo $result;*/    }    /*$data = array(               'userName' => $_POST['userName'],               'gender' => $_POST['gender'],               'age' => $_POST['age'],               'address' => $_POST['address'],               'emailId' => $_POST['emailId'],               'phoneNumer' => $_POST['phoneNumber'],               'zipCode' => $_POST['zipCode'],               'InstAffilliation' => $_POST['instAffil'],               'date' => $date           );*/}?>